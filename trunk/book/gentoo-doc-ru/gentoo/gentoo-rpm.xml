<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="gentoo-rpm" xreflabel="Использование rpm-пакетов в Gentoo">
    <info>
        <title>Использование rpm-пакетов в Gentoo</title>
    </info>
    <para>Ссылка на оригинал: <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/en/java.xml">http://ylsoftware.com/?action=news&amp;na=viewfull&amp;news=402</link>           </para>
    <para>Автор: <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:bulvinkl@gmail.com?subject=По%20поводу%20Вашей%20статьи%20об%20использовании%20rpm-пакетов%20в%20Gentoo">Калинников В.В. a.k.a. MooSe</link>
    </para>
    <para>С версии: 1.5.</para>
    <para>Дата оригинала:  15.02.2008</para>
    <para>Эта статья написана для <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://code.google.com/p/gentoo-doc/">сборника статей о Gentoo</link> по просьбе одного из его авторов - Евгения Батогова a.k.a JohnBat26. Здесь я постараюсь описать возможные способы установки rpm-пакетов в Gentoo. Сразу хочу отметить, что в любом случае лучше всего ставить программы из исходных текстов, используя команду emerge. Использовать же rpm нужно только в самом крайнем случае, когда архив с исходными текстами не доступен (например для коммерческих программ).</para>
    <para>Итак. Есть два способа установить rpm-пакет:</para>
    <orderedlist>
        <listitem>
            <para>Установить в систему менеджер пакетов rpm и пользоваться им. </para>
        </listitem>
        <listitem>
            <para>Написать ebuild для распаковки и установки rpm-пакета. </para>
        </listitem>
    </orderedlist>
    <para>Первый способ проще, но пакет придётся устанавливать с ключом --nodeps и есть большой риск сломать систему или просто получить не рабочий пакет. Второй способ сложнее. Он тоже не решает всех проблем первого, но по крайней даёт возможность избежать поломки системы.</para>
    <para>Будем полагать что мы хотим установить в систему пакет <package>prog-0.1.i386.rpm</package>. Независимо от того, какой способ выбран понадобиться утилита rpm:</para>
    <screen>emerge rpm</screen>
    <para>Теперь рассмотрим первый способ установки. Для начала полезно просмотреть зависимости пакета:</para>
    <screen>rpm -qp --qf "[%{REQUIRENAME} %{REQUIREFLAGS:depflags} %{REQUIREVERSION}\n]" prog-0.1.i386.rpm</screen>
    <para>Получаем примерно вот такой список:</para>
    <screen>/bin/bash
/bin/sh
/bin/sh
/bin/sh
/bin/sh
libX11.so.6
libXext.so.6
libXt.so.6
libc.so.6
libc.so.6(GCC_3.0)
libc.so.6(GLIBC_2.0)
libc.so.6(GLIBC_2.1)
libc.so.6(GLIBC_2.1.2)
libc.so.6(GLIBC_2.1.3)
libc.so.6(GLIBC_2.2)
libc.so.6(GLIBC_2.3)
libdl.so.2
libdl.so.2(GLIBC_2.0)
libdl.so.2(GLIBC_2.1)
libfontconfig.so.1
libfreetype.so.6
libglib-2.0.so.0
libgobject-2.0.so.0
libgtk-x11-2.0.so.0
libm.so.6
libm.so.6(GLIBC_2.0)
libpthread.so.0
libpthread.so.0(GLIBC_2.0)
libpthread.so.0(GLIBC_2.1)
libpthread.so.0(GLIBC_2.2)
libpthread.so.0(GLIBC_2.2.3)
libpthread.so.0(GLIBC_2.3.2)
rpmlib(CompressedFileNames) &lt;= 3.0.4-1
rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1</screen>
    <para>Убеждаемся что всё это у нас есть. Если чего-то не хватает - прикидываем в каком пакете оно может быть и ставим этот пакет. Наконец, когда всё что нужно у нас установлено, устанавливаем сам rpm-пакет:</para>
    <screen>rpm -Uvh --nodeps prog-0.1.i386.rpm</screen>
    <para>Всё. Пакет установлен. Однако всё-таки лучше было бы написать для него ebuild. Для работы с rpm-пакетами в portage есть класс rpm. Самый простой способ ознакомиться с ним это прочитать его исходный код, которые расположен в файле <filename>/usr/portage/eclass/rpm.eclass</filename>. Приведу простой пример ebuild'а для установки rpm:</para>
    <programlisting># Подключаем класс rpm
inherit rpm

# Описываем программу
DESCRIPTION="Cool prog"
HOMEPAGE="http://example.com"
SLOT="0"
KEYWORDS="~x86"
IUSE=""
RESTRICT="nomirror"

# Описываем зависимости
DEPENDS="x11-libs/qt"

# Указываем откуда брать пакет
SRC_URI="http://example.com/files/prog-0.1.i386.rpm"

# Дальше всё будет сделано само. Кроме собственно установки.

# Устанавливаем пакет:
src_install() {
        cp -vR ${S}/* ${D}/
}</programlisting>
    <para>Дальше нужно сохранить этот ebuild в нужном месте (обратитесь к документации portage) и выполнить:</para>
    <screen>ebuild /path/to/file.ebuild digest
ebuild /path/to/file.ebuild merge</screen>
    <para>Всё. Пакет установлен. Причём штатными средствами Gentoo (что немало важно).</para>
    <para>Огромное спасибо пользователю <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://ylsoftware.com/?action=viewprofile&amp;user=Alex">Alex</link> за помощь в написании статьи.</para>
</article>
