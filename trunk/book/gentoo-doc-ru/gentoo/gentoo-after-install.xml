<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
    <info>
        <title> Ещё раз о главном – жизнь после установки </title>
    </info>
    <para>Ссылка на оригинал: <link xlink:href="http://gentoo.blog.ru/6345603.html#comments">http://gentoo.blog.ru/6345603.html#comments</link>
    </para>
    <para>C версии: 1.5</para>
    <para>Автор: gentoo</para>
    <para>
        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo.blog.ru/6345603.html">Дата:</link>
        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo.blog.ru/6345603.html"> 21.02.2008</link>
    </para>
    <para>
        <uri xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo.blog.ru/6345603.html">http://gentoo.blog.ru/6345603.html</uri>
    </para>
    <para>Пост навеян аськой (да, я гентушник, и я не пользуюсь джаббером)), а точнее до боли знакомой фразой "привет! я читал твой блог! Есть вопрос!")) Нет, я совсем не против новых знакомств, у самого когда-то была туча вопросов, и спасибо всем тем, кто терпеливо отвечал и помогал мне в своё время во всём разобраться ;) Но на одних подсказках далеко не уедешь, нужно (нужно!) читать хендбук (благо он на русском) и другие материалы. Хотя по себе знаю, что решения возникшей проблемы всегда хочется "здесь и сейчас", а стоит открыть хендбук и увидеть СКОЛЬКО много там букв, как уже всякое желание читать пропадает)) Напишу здесь ещё несколько советов, которые могут помочь сориентироваться новичкам, может где-то повторюсь, неважно.</para>
    <para>Итак, предположим, вы удачно установили систему и загрузились в неё. Может быть вы уже обновили дерево портежей (по <command>emerge --sync</command>), и может быть пересобрали все пакеты системы (по <command>emerge -epv world</command>). Вобщем готовы двигаться дальше, ставить Х'сы, биться с дровами за direct rendering, компилировать свой любимый DE/WM. Но стоп. Если вы смутно представляете, зачем нужны use-флаги, что такое eix, elogv, как обновлять мир, то вам сначала под кат =)</para>
    <note>
        <para>Совет: Не стоит выбирать профиль "desktop", который включает в себя несколько десятков use-флагов, предположительно подходящих для любой desktop-системы. Все необходимые флаги в любом случае пропишем постепенно в процессе установок пакетов, а добавление на начальном этапе этой кучи флагов из профиля desktop приведёт к большим зависимостям, и вы просто замучаетесь просматривать сто пакетов (и их use-флаги), потянувшихся по зависимостям за установкой всего одного-единственного необходимого вам пакета.</para>
    </note>
    <note>
        <para>Совет: Перед установкой любого пакета, запускать команду emerge сначала с дополнительными ключами "pv" (или "av" – кому как больше нравится). Это даст возможность оценить предстоящий процесс установки, проверить и по необходимости включить (отключить) интересующие USE-флаги устанавливаемых пакетов.</para>
    </note>
    <section>
        <info>
            <title>Полезные пакеты и команды:</title>
        </info>
        <para><command># emerge emerge-delta-webrsync</command> – теперь обновлять дерево портежей будет гораздо быстрее (за счёт экономии трафика), минус – дерево портежей после обновления будет актуально на вчерашний день включительно (изменения за сегодня вы получите только завтра).</para>
        <para><command># emerge eix</command> – с помощью этого пакета гораздо удобнее (и быстрее) работать с поиском по дереву портежей.</para>
        <para><command># eix-sync -Wv</command> – этой командой удобно обновлять дерево портежей, она сделает emerge-delta-webrsync &amp;&amp; update-eix и выведет в конце список изменений в дереве portage (что добавилось, что исчезло, что готово проапгрейдиться).</para>
        <para><command># emerge -uDNvp world</command> (или <option>-uDNva</option>) – предлагаю эту команду для обновления мира (если не придумаете свою, более удобную). Совсем не обязательно обновляться как только хотя бы один пакет появится в выводе этой команды. Я, например, обновляю лишь некоторые пакеты, выборочно и достаточно редко.</para>
        <para><command># emerge elogv</command> – позволит просматривать информационные сообщения всех устанавливаемых пакетов после их установки, но сначала необходимо его настроить. Как настроить – читаем в строках после установки, у меня настроено так (<filename>/etc/make.conf</filename>):</para>
        <programlisting>PORTAGE_ELOG_CLASSES="warn error log qa"
PORTAGE_ELOG_SYSTEM="save"</programlisting>
        <para>А если также добавить строку:</para>
        <para><code>PORT_LOGDIR=/var/log/portage</code>, то вся информация выводимая на экран во время компиляции пакета будет помещаться в указанный каталог (на случай, если вас не устроит elogv).</para>
        <note>
            <para>Совет: не пренебрегайте этой командой, после установки крупных вещей (Х'сы, Gnome, KDE) обязательно запустите <command>elogv</command> и внимательно просмотрите сообщения всех пакетов, что устанавливались. В выводе некоторых могут встречаться важные инструкции, которые необходимо будет выполнить. Удалить текущую запись из журнала <command>elogv</command> – dd, помощь — <keycap>F1</keycap>.</para>
        </note>
        <para><command># emerge gentoolkit</command> – сюда входят <command>eclean</command>, <command>equery</command>, <command>eread</command>, <command>euse</command>, <command>glsa-check</command>, а главное – <command>revdep-rebuild</command>. Must have.</para>
    </section>
    <section>
        <info>
            <title>Обновление конфигов.</title>
        </info>
        <para>При обновлении некоторых пакетов может потребоваться вручную обновить их конфиги. Если после установки какого-либо пакета вы видите на экране такое сообщение:</para>
        <screen> * IMPORTANT: 2 config files in '...' need updating.</screen>
        <para>значит некоторые конфиги ждут своего обновления. Обновить их можно либо с помощью <command>etc-update</command>, либо с помощью <command>dispatch-conf</command>. Рекомендуется использовать вторую команду, как более мощную, а при соответствующей настройке, умеющую сохранять историю изменений. В любом случае здесь рекомендуется включать мозг и внимательно изучать, какие строчки будут удалены, а какие – добавлены. Если обновляется какой-либо конфиг, где вы вносили свои корректировки, они могут быть предложены к удалению – поэтому нужно быть внимательным (сам по-первости попался – обновил конфиги не глядя, а потом удивлялся, почему настройки, которые я терпеливо прописывал в несколько файлов вдруг заменились на дефолтные).</para>
    </section>
    <section><info>
            <title>USE-флаги</title>
        </info>
        <qandaset>
            <qandaentry>
                <question>
                    <para>C флагами я не совсем разобрался... зачем их прописывать, если проги и без них поставятся?</para>
                </question>
                <answer>
                    <para>Предположим, ставим мы с тобой kopete (IM-клиент). Ты не включаешь никакие флаги и ставишь пакет, а я включаю "irc" и "yahoo". Так вот мой копете будет поддерживать также протоколы irc и yahoo, а твой – не будет.</para>
                </answer>
            </qandaentry>
            <qandaentry>
                <question>
                    <para>Т.е. прогу надо будет заново ставить?</para>
                </question>
                <answer>
                    <para>Да, тебе придётся прописать флаги и пересобрать пакет. USE-флаги нужны для того, чтобы включать некоторый функционал в собираемом пакете.</para>
                </answer>
            </qandaentry>
            <qandaentry>
                <question>
                    <para>Вот мы дали команду <command>emerge gnome -pv</command></para>
                    <para>Там появились строки..красного, синего и желтого цвета...что это все означает?</para>
                </question>
                <answer>
                    <para>Жёлтым% выделены изменения в наборе флагов пакета. Флаги, больше недействительные (удалённые) для новой версии пакета будут взяты в скобки, новые (добавленные) флаги, появившиеся для новой версии, будут без скобок.</para>
                    <para>Красные – включенные флаги. </para>
                    <para>Синие – соответственно не включенные (идут по минусу).</para>
                    <para>Зелёные* – флаг был включен в системе после сборки пакета, пакет был собран без этого флага, готов к пересборке с ним.</para>
                    <para>Например:</para>
                    <screen>[ebuild     UD] app-emulation/wine-0.9.49 [0.9.57]</screen>
                    <para>предлагает понизить версию пакета wine (я ставил тестовую 0.9.57, у которой были доступны новые use-флаги "gecko" и "samba", и которых не будет, если пересобрать пакет в версию 0.9.49).</para>
                    <para>Флаг "java" я включил в системе только что, и поэтому он подсветился во всех пакетах, где он может использоваться, зелёным цветом.USE-флаги добавляются (включаются) в системе по мере необходимости.</para>
                </answer>
            </qandaentry><qandaentry>
                <question>
                    <para>Ну вот я и пытаюсь узнать..как определить необходимость?</para>
                </question>
                <answer>
                    <para>К примеру, поставил ты систему, чист твой <filename>/etc/make.conf</filename>, включено только несколько обязательных флагов (прописаны в профиле). Теперь хочешь установить <package><replaceable>Пакет_А</replaceable></package>, по-хорошему пишешь:</para>
                    <screen><prompt>#</prompt> <userinput>emerge <replaceable>&lt;Пакет_А&gt;</replaceable> -pv</userinput></screen>
                    <para>и смотришь use-флаги всех пакетов, что будут устанавливаться. Какие флаги тебе кажутся нужными – включаешь (прописываешь). И ещё раз перезапускаешь команду (могут появиться новые зависимости со своими флагами). Процесс повторять до полного удовлетворения =)</para>
                    <para>Если прописываешь флаги в<filename> make.conf</filename> – то они будут действовать глобально для всех пакетов, где встретятся. Если в <filename>/etc/portage/package.use</filename> в формате: <code><replaceable>категория</replaceable>/<replaceable>пакет флаг</replaceable> [<replaceable>флаг</replaceable> -<replaceable>флаг</replaceable>]</code> (<code>app-misc/mc 7zip -X -gpm -ncurses slang</code>) то тогда эти флаги будут включены только для этого пакета.</para>
                    <para>Обычно в <filename>make.conf</filename> находится некоторое количество глобальных флагов (X, kde, gnome, alsa, etc...) и много-много строк в <filename>package.use</filename>. Так постепенно use-флаги и накапливаются. А если ты сразу пропишешь в <filename>make.conf</filename> "Х, kde, gnome, samba" и т.д. (думая, что "вот сейчас я пропишу всё что мне надо и забуду про эти флаги"), то установка какого-нибудь mc потянет за собой столько пакетов по зависимостям... что ты будешь совсем не рад =) Причём, есть вероятность, что всё зациклится и выпадет ошибка.</para>
                    <para>Смотреть, что означает конкретный флаг удобно в другой консоли в <command>ufed</command>.</para>
                    <para>В <filename>make.conf</filename> можно прописать дефолтные опции, которые всегда будут ставится после emerge, к примеру, так: <code>EMERGE_DEFAULT_OPTS="--ask --verbose"</code>
                    </para>
                    <para>Еще стоит отметить, как более правильно распределять флаги между <filename>make.conf</filename> и <filename>package.use</filename>. У меня сейчас глобальные флаги, описывающие всю мою систему, в <filename>make.conf</filename>, а более локальные – относящиеся к конкретным программам – в <filename>package.use</filename>. Так наверно более удобно. Вообще я как-то стремлюсь сократить число флагов в <filename>make.conf</filename>.</para>
                    <para>Полезный пакет:</para>
                    <para><command># emerge ufed</command> – интерактивный ncurses-based редактор use-флагов. В нём флаги можно включать (отключать) и <command>ufed</command> будет прописывать их в <filename>/etc/make.conf</filename>. Конечно информация о флагах здесь не настолько подробная, как хотелось бы (особенно для новичка), но всё же лучше чем ничего.</para>
                </answer>
            </qandaentry><qandaentry>
                <question>
                    <para>Но ведь можно сделать так:</para>
                    <screen><prompt>#</prompt> <userinput>USE="<replaceable>флаг</replaceable>" emerge <replaceable>&lt;пакет&gt;</replaceable></userinput></screen>
                </question>
                <answer>
                    <para>А при обновлении мира, флаг у этого пакета потеряется, ибо нигде не прописан, то есть при пересборке (обновлении пакета) получится <command>USE="-<replaceable>флаг</replaceable>" emerge <replaceable>&lt;пакет&gt;</replaceable></command> и пакет потеряет часть функциональности.</para>
                </answer>
            </qandaentry><qandaentry>
                <question>
                    <para>&gt;понял, а как быть, если прога тянет за собой другие, а у тех свои зависимости?</para>
                </question>
                <answer>
                    <para>Смотришь их флаги, включаешь, а они после этого потянут ещё что-нибудь... смотришь теперь и их флаги)) пока не остановится процесс разрастания))</para>
                    <para>Если не планируется использовать <command>deltup</command>, можно прописать зеркало yandex в <filename>make.conf</filename>:</para>
                    <programlisting>GENTOO_MIRRORS="http://mirror.yandex.ru/gentoo-distfiles/ ";</programlisting>
                    <para>(хотя эта строка и при дельтапе не помешает).</para>
                </answer>
            </qandaentry></qandaset>
    </section>
    <section>
        <info>
            <title>Поддержание системы в чистоте и порядке =)</title>
        </info>
        <para>При установке пакета <package>А</package>, он прописывается в world (<filename>/var/lib/portage/world</filename>), все пакеты <package>B</package>
            <package>C</package>
            <package>D</package>, которые он потянул за собой по зависимостям никуда не прописываются, но они нужны пакету А и поэтому не болтаются в системе мёртвым грузом. Соответственно команда </para>
        <screen><prompt>#</prompt> <userinput>emerge -a —depclean</userinput></screen>
        <para> не сообщает ни о каких бесхозных пакетах.</para>
        <para>Пакет <package>А</package> нам надоел и мы его удаляем:</para>
        <screen><prompt>#</prompt> <userinput>emerge -C <replaceable>пакет_А</replaceable></userinput></screen>
        <para>Но пакеты <package>B</package>
            <package>C</package>
            <package>D</package> всё ещё остаются в системе, совершенно ненужные никому. Удалить их можно лишь точно зная их имена, либо с помощью команды</para>
        <screen><prompt>#</prompt> <userinput>emerge -a -depclean</userinput></screen>
        <section>
            <info>
                <title>Проверка целостности системы:</title>
            </info>
            <para><command>revdep-rebuild</command> – команда проверит целостность зависимостей системы, и при необходимости (найденных ошибках) переустановит (доустановит) необходимые пакеты. Рекомендуется запускать всегда после выполнения команды </para>
            <para><command>emerge -a -depclean</command>.</para>
        </section>
    </section>
    <section><title>"Masked" пакеты.</title><qandaset><qandaentry>
                <question>
                    <para>А еще один вопрос – хочу проставить rawstudio, а это программа под маской. Как правильно снять маску на эту программу. В хелпе написано, что они могут быть замаскированны несколькими путями.</para>
                </question>
                <answer>
                    <para>По умолчанию используется стабильная ветвь ПО. Большое количество пакетов (версий) могут находиться в тестовой ветви. Это не означает, что эти пакеты ужасно нестабильные, отнюдь, вполне возможно, что они будут стабильно работать у вас 364 дня в году ;) Чтобы использовать такие пакеты, есть два варианта:</para>
                    <para>
                        <orderedlist>
                            <listitem>
                                <para>Можно перейти полностью на тестовую ветвь и иметь всегда последние версии ПО.</para>
                            </listitem>
                            <listitem>
                                <para>Либо можно комбинировать стабильную ветвь с некоторыми пакетами из тестовой.</para>
                            </listitem>
                        </orderedlist>
                    </para>
                    <para>В данном случае видим:</para>
                    <screen><prompt>#</prompt> <userinput>eix rawstu</userinput>
* media-gfx/rawstudio
     Available versions:  ~0.6 ~0.7
     Homepage:            http://rawstudio.org
     Description:         a program to read and manipulate raw images from digital cameras.</screen>
                    <para>Обе версии пакетов замаскированы тильдой, т.е. относятся к тестовой ветви ПО. Снять такую маску можно прописав <code><replaceable>категория</replaceable>/<replaceable>пакет</replaceable> ~x86</code> в <filename>/etc/portage/package.keywords</filename>, например:</para>
                    <programlisting>media-gfx/rawstudio ~x86
<lineannotation>(вместо ~x86 может быть ~amd64, либо **)</lineannotation></programlisting>
                    <para>Второй случай: <code>[M]</code> – пакет заблокирован.</para>
                    <screen><prompt>#</prompt> <userinput>eix kde-meta</userinput>
* kde-base/kde-meta
     Available versions:
        (3.5)   3.5.8 ~3.5.9
        (kde-4) [M]~4.0.1 [M]~4.0.2</screen>
                    <para>Здесь kde-4 помечен как находящийся в тестовой ветви (<code>~</code>), плюс к тому же заблокирован от использования (<code>M</code>), т.е. разработчики не рекомендуют пока его использовать – обязательно будут ошибки. Но если очень хочется... ;) то можно разблокировать, прописав <code><replaceable>категория</replaceable>/<replaceable>пакет</replaceable></code> в <filename>/etc/portage/package.unmask</filename>, например:</para>
                    <programlisting>kde-base/kde-meta</programlisting>
                    <para>(и в данном случае нужно будет также снять тильду, как описано выше).</para>
                </answer>
            </qandaentry></qandaset></section>
    <section>
        <info>
            <title>Установка пакетов. Х'сы, DE.</title>
        </info>
        <para>Опишу свои личные соображения. Так как система будет использоваться на десктопе для повседневной работы, то обязательно понадобятся Х'сы, какое-то DE, различные кодеки и прочие приложения. Можно сказать <command>emerge gnome</command> или <command>emerge kde</command> и потом долго ковыряться в use-флагах нескольких сотен пакетов – а их будет много, ибо потянутся и Х'сы, а если повезёт, то захватятся и кодеки. Зато, если хватит сил, вся система будет установлена одной командой =)</para>
        <para>Я же предпочитаю разбивать этот процесс на подпроцессы:</para>
        <para><command>emerge xorg-x11</command> – ставим только Х'сы, драйвер на видеокарту, добиваемся его работы и direct rendering'а.</para>
        <para><command>emerge ffmpeg imagemagick xine-lib mplayer</command> – в каком порядке не особо важно, главное не одновременно (а то опять увязнете в сотне-другой зависимостей). После установки этих пакетов и всех нужных зависимостей, в системе будут стоять все необходимые видео/аудио кодеки, а также будет поддержка графических форматов. Здесь же может потянуться в зависимостях samba и cups.</para>
        <para>И уже последним делом:</para>
        <para><command>emerge gnome</command> (или <command>kde-meta</command>) – Гном, KDE, либо что вам там нравится.</para>
        <para>Наблюдать за процессом установки можно в другой консоли, запустив: </para>
        <para><command>tail -f /var/log/emerge.log</command></para>
        <para>Надеюсь, эта информация помогла вам разобраться хоть в каких-то вопросах =)</para>
        <para>Внимание! Этот пост не отменяет прочтение хендбука, так что вам теперь сюда: <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/ru/handbook/">http://www.gentoo.org/doc/ru/handbook/</link>
        </para>
        <para>
            <link xlink:href="http://www.gentoo.org/doc/ru/handbook/">HandBook 2006.1 ru</link>, <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/en/handbook/">HandBook 2007.0 en</link>, <link xlink:href="#">Советы пользователям Gentoo</link>
        </para>
        <para>
            <uri xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo.blog.ru/6345603.html">http://gentoo.blog.ru/6345603.html</uri>
        </para>
    </section>
</article>
