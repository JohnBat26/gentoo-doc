<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
    <info>
        <title>Обновление Gentoo Linux</title>
    </info>
    <section>
        <info>
            <title>Руководство по обновлению Gentoo</title>
        </info>
        <para>Ссылка на оригинал:  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/ru/gentoo-upgrading.xml">http://www.gentoo.org/doc/en/gentoo-upgrading.xml</link>
        </para>
        <para>С версии: 1.2</para>
        <para>Перевод:  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:vnp@bayarea.net">vnp</link>, <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:mike.spacer">Михаил Ярмиш</link>, <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:achumakov@gentoo.org">Алексей Чумаков</link>, <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:JohnBat26@gmail.com?subject=Обновление%20Gentoo">Батогов Е.В, a.k.a JohnBat26</link>
        </para>
        <note>
            <para>Из оригинала включён только самый актуальный материал!</para>
        </note>
        <section>
            <info>
                <title>Gentoo и обновления</title>
            </info>
            <section>
                <title>Философия</title>
                <para>Здесь, на земле Gentoo, обновление понимается совсем не так, как во всем остальном мире Linux. Вы, вероятно, уже знаете, что в наших дистрибутивах мы никогда не следовали «классическому» способу обновления программ: дождаться нового релиза, скачать его, прожечь, засунуть диск в дисковод и, наконец, следовать установочным инструкциям. </para>
                <para>Вы знаете (вы же не зря выбрали Gentoo), как такой процесс раздражает опытного пользователя, стремящегося всегда быть на переднем крае. Учитывая популярность и распространенность инструментов типа apt или apt-rpm, облегчающих быстрые и частые обновления, мы полагаем, что и опытные пользователи других дистрибутивов испытывают те же чувства. Однако ни один дистрибутив не приспособлен для удовлетворения нужд требовательных пользователей лучше Gentoo, поскольку Gentoo с самого начала строился на идее быстрых последовательных обновлений. </para>
                <para>В идеале, вы устанавливаете систему однажды, и более никогда не беспокоитесь о выпусках: просто следуйте инструкциям из введения в Portage в настольной книге Gentoo, где описывается, как поддерживать актуальность системы. Хотя обычно такого подхода достаточно, иногда в ядро системы вносятся изменения, требующее установки вручную. </para>
            </section>
            <section>
                <title>Выпуски и профили</title>
                <para>О процессе выпуска версий Gentoo постоянно задают вопрос: «Зачем нужно часто делать новые выпуски, если они не предназначены для обновления программ у пользователей?". Тому есть ряд причин: </para>
                <para>Новый выпуск — это новые исправленные и дополненные установочные диски. </para>
                <para>Новый выпуск несет обновленный набор пакетов GRP, так что пользователи, избирающие «быстрый способ» установки (stage3 + заранее скомпилированные пакеты), получают не устаревшую систему. </para>
                <para>Наконец, в новых выпусках время от времени реализуются функции, несовместимые с предыдущими выпусками. </para>
                <para>Если в выпуск входят возможности, несовместимые с предыдущими, или содержится набор фундаментальных пакетов и установок, сильно меняющих поведение системы, мы говорим, что он задает новый профиль. </para>
                <para><indexterm><primary>Профиль</primary></indexterm>Профиль — это набор конфигурационных файлов, хранимый в подкаталоге <filename>/usr/portage/profiles</filename>, описывающий сценарии ebuild системных пакетов, флаги использования (<envar>USE</envar>) по умолчанию, отображение виртуальных пакетов по умолчанию, а также архитектуру, на которой запускается система. </para>
                <para>Используемый профиль определяется символьной ссылкой <filename>/etc/make.profile</filename>, которая указывает на подкаталог в <filename>/usr/portage/profiles</filename>, содержащий файлы профиля. К примеру, профиль x86 2007.0 по умолчанию находится в <filename>/usr/portage/profiles/default-linux/x86/2007.0</filename>. Файлы в родительских каталогах также входят в состав профиля (и, таким образом, совместно используются различными подпрофилями). Поэтому мы называем такие профили каскадными профилями.</para>
                <para>Профили, устаревающие с появлением новых, хранятся в <filename>/usr/portage/profiles</filename> наравне с актуальными, но помечены как как нежелательные для использования. Для этого в каталог профиля помещается файл deprecated. Файл содержит имя профиля, на который рекомендуется обновиться. Portage использует эту информацию для автоматического предупреждения о необходимости перехода на новый профиль.</para>
                <para>Существуют различные причины для создания нового профиля: выпуск новых несовместимых версий базовых пакетов (таких, как baselayout, gcc, или glibc), изменения в USE-флагах по умолчанию или отображении виртуальных пакетов, или, возможно, серьезные системные изменения. </para>
            </section>
        </section>
        <section>
            <info>
                <title>Гонка за новыми выпусками</title>
            </info>
            <section>
                <title>Выпуски без изменений в профиле</title>
                <para>Если объявлен новый выпуск Gentoo, в котором не появился новый профиль, то твердо можно притвориться, что вы его не заметили :). </para>
                <para>Ваша система будет в точности соответствовать вновь установленной с нового выпуска, если вы обновите установленные пакеты согласно описанию из Настольной книги Gentoo. </para>
            </section>
            <section>
                <title>Выпуски с изменениями в профиле</title>
                <para>Если в выпуске появился новый профиль (как, например, в 2007.0 для x86), у вас есть возможность на него перейти. </para>
                <para>Естественно, вы не обязаны это делать, и можете продолжать пользоваться старым профилем, просто обновляя свои пакеты, как описано в Настольной книге Gentoo. </para>
                <para>Однако, Gentoo крайне рекомендует обновлять профиль, если он объявляется нежелательным для использования. Когда такое происходит, это означает, что разработчики больше не планируют его поддерживать. В приведенной ниже таблице можно быстро уточнить, какие профили поддерживаются в данный момент. </para>
                <para>Переход на новый профиль придется осуществлять вручную. Необходимые действия могут сильно отличаться от выпуска к выпуску, в зависимости от глубины изменений, привносимых в новом профиле. </para>
                <para>В простейшем случае, вам просто потребуется изменить символьную ссылку <filename>/etc/make.profile</filename>, а в худшем — придется перекомпилировать всю систему, тем временем изображая танец вуду. Процесс перехода обычно описывается в замечаниях к выпуску. Кроме того, есть инструкции в конце данного руководства. </para>
            </section>
            <section>
                <title>Поддерживаемые профили</title>
                <para>Вы можете увидеть список профилей на Вашей архитектуре, официально поддерживаемой Gentoo когда установите утилиту eselect (<command>emerge eselect</command>) и затем выполните следующую команду:</para>
                <example>
                    <title>Просмотр поддерживаемых профилей</title>
                    <screen><prompt>#</prompt> <userinput>eselect profile list</userinput></screen>
                </example>
            </section>
        </section>
        <section>
            <info>
                <title>Инструкции по обновлению профилей</title>
            </info>
            <section>
                <title>Общие инструкции.</title>
                <important>
                    <para>Удостоверьтесь в том, что Ваши портэжи обновлены перед выполнением любых изменений с профилями !</para>
                </important>
                <para>Первое, выполните <command>emerge eselect</command>. Утилита eselect  позволяет Вам просматривать и выбирать профили без необходимости создания или удаления символических ссылок вручную.</para>
                <example>
                    <title>Выбор профиля с помощью утилиты eselect</title>
                    <screen><lineannotation>(Просмотр доступных профилей)</lineannotation>
<prompt>#</prompt> <userinput>eselect profile list</userinput>

<lineannotation>(Выберите номер Вашего желаемого профиля из списка)</lineannotation>
<prompt>#</prompt> <userinput>eselect profile set <replaceable>&lt;номер профиля&gt;</replaceable></userinput></screen>
                </example>
                <para>Если Вы предпочитаете изменять профили вручную, тогда просто сделайте следующее:</para>
                <example>
                    <title>Изменение профилей вручную.</title>
                    <screen><prompt>#</prompt> <userinput>rm /etc/make.profile</userinput>
<prompt>#</prompt> <userinput>ln -s ../usr/portage/profiles/<replaceable>&lt;выбранный профиль&gt;</replaceable> /etc/make.profile</userinput></screen>
                </example>
                <note>
                    <para>Для большинства архитектур существуют два типа подпрофилей: desktop и server. Внимательно изучите эти профили, так как они могут удовлетворять Вашим нуждам лучше, чем чрезвычайно минимальные профили по умолчанию.</para>
                </note>
            </section>
            <section>
                <title>Обновление до 2007.0 или 2006.1</title>
                <para>Если Вы намереваетесь обновиться до уровня этих профилей, то Вам следовало бы знать, что  они ожидают что по умолчанию в системе установлена локаль Unicode. Или более точно, должна быть определена  строка <code>UNICODE="yes"</code>  в файле <filename>/etc/rc.conf</filename>.  Для этоо Вы должны создать Unicode локаль для Вашей системы. Пожалуйста, прочитайте <link xlink:href="#">UTF-8 guide</link> чтобы узнать как создать правильную локаль.</para>
                <para>Альтернативно, если Вы не желаете устанавливать локаль, тогда Вы можете определить <code>UNICODE="no"</code> в файле <filename>/etc/rc.conf</filename>. И переустановить (re-emerge) пакет baselayout (или ждите следующего обновления этого пакета) с <envar>USE</envar> флагом: <code>-unicode</code>. Вы можете установить <code>-unicode</code> только для baselayout или Вы  можете установить его глобально для всех пакетов, добавив Вашу переменную USE в файл <filename>/etc/make.conf</filename>.</para>
                <example>
                    <title>Опционально: удаление поддержки Unicode.</title>
                    <screen><lineannotation>(Для удаления поддержки Unicode только для baselayout)</lineannotation>
<prompt>#</prompt> <userinput>echo "sys-apps/baselayout -unicode" >> /etc/portage/package.use</userinput>
<prompt>#</prompt> <userinput>emerge -a baselayout</userinput>

<lineannotation>(Для удаления поддержки Unicode для всей системы)</lineannotation>
<prompt>#</prompt> <userinput>nano -w /etc/make.conf</userinput>
USE="-unicode"
<prompt>#</prompt> <userinput>emerge -a baselayout</userinput></screen>
                </example>
                <note>
                    <para>Если Вы обновляетесь до 2007.0 на архитектуре SPARC, тогда вы должны следовать  <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/en/gcc-upgrading.xml">GCC Upgrading Guide</link></para>
                </note>
            </section>
        </section>
    </section>
</article>
