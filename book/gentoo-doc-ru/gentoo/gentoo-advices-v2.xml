<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
    <info>
        <title>Советы пользователям Gentoo (вариант 2)</title>
    </info>
    <para>Ссылка на оригинал: <link xlink:href="http://lxj.endofinternet.net/column/gentoo-tips/">http://lxj.endofinternet.net/column/gentoo-tips/</link></para>
        <para>C версии: 1.5</para>
        <para>Автор: <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="mailto:gotletter@gmail.com?subject=По%20поводу%20вашей%20статьи:%20Советы%20пользователям%20Gentoo%20">Алексеев Алексей</link></para>
        <para>Дата: 12.02.2008</para>
        <para/>
        <para>В своё время я написал две статьи для Linux.com с советами для пользователей Gentoo (<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.linux.com/articles/56270">Gentoo Portage secrets</link> и <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.linux.com/articles/58503">Tips for new Gentoo users</link>), при чём вторая <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://dumponline.blogspot.com/2006/11/blog-post.html">оказалась такой удачной</link>, что не только <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://digg.com/linux_unix/Tips_for_new_Gentoo_users">попала в топ digg’а</link>, но и была в тот же день переведена на русский язык!</para>
        <para>Я решил собрать в одной статье всю актуальную информацию из обеих статей (они, в принципе, остались актуальными на 90%), и добавить немного нового материала. Ну и перевести, в конце концов, так, как я считаю нужным :)</para>
    <section>
        <info><title>Если вы только собираетесь начать работу с Gentoo</title></info>
            <para>Приготовьтесь читать много документации, особенно поначалу. Собственно, вы и установить Gentoo не сможете, не изучив <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/en/handbook/index.xml">Gentoo Handbook</link>.</para>
            <para>Есть, конечно, графический инсталлятор, есть <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://sabayon.org/">Sabayon</link>, но без понимания основ вы далеко не уйдёте. Да и вообще, при работе с Gentoo не рассчитывайте на графические средства настройки — зато консольные средства настройки и организация конфигурационных файлов в Gentoo весьма удобны.</para>
            <para>Handbook освещает установку и основы работы с Gentoo. Когда придёт время настраивать иксы и ALSA, переходите к <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/en/list.xml">Gentoo Documentation Resources</link>. Если вы не нашли информации по интересующей вас теме и там, то она скорее всего есть в <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-wiki.com/Main_Page">Gentoo wiki</link>.</para>
            <para>Найти что-либо, что не описано в Gentoo wiki довольно сложно, так что не забывайте туда заглянуть, прежде чем посетить официальный <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://forums.gentoo.org/">форум</link> и <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/main/en/irc.xml">IRC-каналы</link>.</para>
            <para>Выше я приводил ссылки на англоязычные источники, как и в оригинале статьи. Если у вас нет проблем с английским языком, то лучше их и придерживаться, когда вы что-либо ищите — англоязычная документация практически всегда более актуальная и более полная. Но и документации на русском есть немало: и <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/ru/handbook/">Handbook</link>, и <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/ru/">официальный перевод прочей документации</link>, <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://ru.gentoo-wiki.com/">русскоязычный раздел Gentoo Wiki</link>. Большой русскоязычный форум о Gentoo вы можете найти на <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo.ru/">Gentoo.ru</link> (там же вы найдёте ссылки на IRC-каналы), ну и крупнейший русскоязычный форум о Linux — <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://linuxforum.ru/">LinuxForum</link>.</para><section><info><title>Основы Portage</title></info>
                <para>Шутка. Тут этот раздел вообще не нужен. Вы ведь прочли Handbook, как это было сказано в предыдущем разделе? Хотя в оригинальную статью этот раздел по настоятельной просьбе редакторов пришлось всё-таки включить.</para></section><section><info><title>Настройка Portage</title></info>
                    <para>Первое правило Gentoo — внимательно следите за вашими USE-флагами. Множество глупых вопросов снимается, если вы перепроверите свои USE-флаги. Почему Midnight Commander тянет за собой в зависимостях X.org? Потому что у вас установлен флаг X. Почему вместе с KDE не установился KPDF? Потому что вы забыли про флаг pdf. <emphasis>(Почему же всё-таки был установлен KGhostScript? Понятия не имею, да и вообще — KDE4 на носу)</emphasis>
                    </para>
                    <para>Для того, чтобы увидеть, с какими флагами будет установлен новый пакет, запускайте emerge с параметрами –ask и –verbose (-av) (–ask лучше –pretend тем, что зависимости не пересчитываются лишний раз). Обязательно установите пакет gentoolkit — среди прочих полезностей, он содержит утилиту euse, которая облегчает управление USE-флагами. Запустите euse -i flag, чтобы увидеть описание флага, и узнать, актвирован ли он. Прочитайте man euse, чтобы узнать о всех возможностях этой команды (нет, правда, прочитайте — там немного).</para>
                    <para>Чтобы установить какую-либо программу с другими USE-флагами, иногда советуют запустить USE="some flags" emerge moo, но ни в коем случае так не делайте: при следующем обновлении пакет будет перекомпилирован со старым набором флагов. Для настройки USE-флагов для отдельных пакетов используйте /etc/portage/package.use (это или файл, или каталог с файлами, см. ниже). То есть если вы хотите установить пакет moo категории category с флагами some flags, то наберите echo "category/moo some flags" &gt;&gt; /etc/portage/package.use перед установкой.</para>
                    <para>То же самое относится и к ACCEPT_KEYWORD — используйте /etc/portage/package.keywords. Начиная с версии Portage 2.1, вы можете хранить такие настройки не в одном большом файле package.keywords, а создать несколько небольших файлов, и положить их в каталог /etc/portage/package.keywords. Это относится ко всем файлам в /etc/portage.</para></section><section><info><title>Когда нужно использовать оверлеи</title></info>
                        <para>Иногда бывает нужно установить пакет (или версию пакета), которого ещё (или уже) нет в Portage. На пример, вы можете найти ebuild, который уже был удалён из официального дерева в <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/cgi-bin/viewcvs.cgi/">CVS-репозитории</link>. Или же вы нашли ebuild для нового пакета в <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://bugs.gentoo.org/">Gentoo Bugzilla</link>. А может быть, вас чем-то не устраивает официальный ebuild, и вы решили внести в него свои изменения.</para>
                        <para>В таком случае, вы должны создать собственный локальный оверлей, и положить свои ebuild’ы туда. Оверлей — это набор ebuild’ов, которые вы хотите «подмешать» к основной базе Portage. Ни в коем случае не храните свои ebuild’ы в /usr/portage — при первой же синхронизации они будут удалены. Создайте каталог для своего оверлея, и создайте в нём структуру каталогов, подобную /usr/portage. Расположите ваши ebuild’ы соответственно. Затем откройте /etc/make.conf, и добавьте строчку PORTDIR_OVERLAY="/path/to/local/overlay".</para>
                        <para>Обычное место для оверлеев — /usr/local/overlays, так что свой оверлей вы можете сделать в /usr/local/overlays/local. Что ещё может оказаться в /usr/local/overlays?</para>
                        <para>Есть множество неофициальных оверлеев, с которыми можно синхронизироваться. Для любого из них можно создать оверлей в /usr/local/overlays, и синхронизировать их (по тому же принципу, как вы синхронизируете официальное дерево Portage, когда запускаете emerge --sync). Разные неофициальные оверлеи используют для синхронизации утилиты rsync, svn или git, что оговаривается в описании оверлея.</para>
                        <para>В прочем, большинство из этих оверлеев вы можете использовать при помощи утилиты layman. В таком случае вам не нужно самомостоятельно создавать каталог для оверлея и запускать rsync/svn/git для получения обновлений — вы просто вводите layman -a название-оверлея, чтобы «подключиться» к оверлею — то есть, чтобы layman сам создал каталог, скачал туда нужные файлы и добавил путь в файл настройки; а затем запускаете layman -S, чтобы обновить все оверлеи.</para>
                        <para>Подробнее об управлении оверлеями, об установке layman и о том, какие вообще есть полезные оверлеи, можно узнать <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-wiki.com/Portage_Overlay">на Gentoo wiki</link>. Оверлеи, как правило, обсуждаются в разделе <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://forums.gentoo.org/viewforum-f-51.html">Unsupported software</link> официальных форумов Gentoo.</para></section><section><info><title>Как часто нужно обновляться?</title></info>
                            <para>Не стоит запускать emerge --sync и layman -S чаще раза в сутки. Да и этого, как правило, более чем достаточно. Вы можете отслеживать появление интересующих вас пакетов на сайтах <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://packages.gentoo.org/">http://packages.gentoo.org/</link> или <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-portage.com/">http://gentoo-portage.com/</link> (или же подписавшись на соответствующие RSS-ленты), и, таким образом, синхронизировать дерево Portage и обновлять пакеты только тогда, когда в официальном дереве появятся новые версии используемого вами ПО.</para>
                            <para>Чтобы не пропускать важные обновления безопасности, используйте утилиту <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://forums.vpslink.com/archive/index.php/t-745.html">glsa-check</link> из пакета gentoolkit. В настоящее время эта функциональность ещё дорабатывается, но в будущем glsa-check станет частью Portage. Чтобы узнать, есть ли уязвимости среди установленных пакетов, запустите glsa-check -l affected. Выполнив glsa-check -d &lt;код уязвимости&gt;, вы увидите подробную информацию по определённой уязвимости (вы можете также сразу запустить glsa-check -d affected)</para>
                            <para>В то же время, не обновляетесь слишком редко. Если вы не будете обновлять систему больше месяца, то когда вы в конце концов соберётесь обновляться, у вас возникнет множество проблем.</para>
                            <para>Не забывайте читать <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/news/en/gmn/">Gentoo Monthly Newsletter</link>, практически все важные вопросы связанные с нетривиальными обновлениями, там всегда освещаются. Да и вообще подписаться на RSS-ленту новостей с gentoo.org (или хотя бы gentoo.ru) — это очень хорошая идея.</para>
                            <para>
                                <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://forums.gentoo.org/viewtopic-t-546828.html">Этот скрипт</link> с простым названием update упрощает процедуру обновления:</para>
                            <orderedlist>
                                <listitem>
                                    <para>на экран не выводятся сообщения от компилятора — только сообщения от emerge; </para>
                                </listitem>
                                <listitem>
                                    <para>если какой-то пакет не удаётся установить, то выполнение обновления не прерывается: скрипт в конце работы пытается ещё раз установить этот пакет, затем выводит список всех пакетов, которые так и не удалось установить; </para>
                                </listitem>
                                <listitem>
                                    <para>в некоторых случаях автоматически разрешаются блокировки пакетов (пакет А версии ниже X блокируют установку пакета B версии Y: обычно emerge не сможет продолжить работу, пока вы сами не обновите пакет A, а update это делает сам) </para>
                                </listitem>
                            </orderedlist></section><section><info><title>Держите «мир» в чистоте</title></info>
                                <para>Каждый раз, когда вы устанавливаете какой-либо пакет, его название записывается в /var/lib/portage/world. Когда вы обновляете ваши пакеты, вы запускаете что-то вроде emerge --update --deep world — именно тогда этот список и используется. Старайтесь, чтобы он был как можно короче; только программы, которые вы используете напрямую, должны туда попадать. Если какой-либо пакет установлен как зависимость другого, то он скорее всего не должен попадать в world.</para>
                                <para>Например, когда вы устанавливаете пакет, использующий библиотеку wxWidgets, то она автоматически устанавливается среди прочих зависимостей этого пакета, но не добавляется в world. Если вы удалите все пакеты, которые зависят от wxWidgets, то она перестанет обновляться при emerge --update (...) world; и будет удалена из системы, если вы запустите emerge --depclean. Только если вы сами разрабатываете программы с использованием wxWidgets, вы захотите, чтобы она входила в world.</para>
                                <para>Утилита udept может помочь вам удалить лишние пакеты из списка world:</para>
                                <para>emerge udept</para>
                                <para>dep -aw</para>
                                <para>Чтобы установить или обновить пакет напрямую, но без добавления его в этот список, используйте опцию –oneshot (-1). Это может быть полезно, на пример, для временной установки какого-либо пакета.</para></section><section><info><title>Об удалении пакетов.</title></info>
                                    <para>Не забывайте, что emerge --unmerge не проверяет, используется ли удаляемый пакет другими пакетами. Также будьте осторожны с emerge --depclean, так как иногда она может удалить пакеты, которые вам нужны.</para>
                                    <para>Иногда при обновлении одного пакета, перестаёт работать другой, который, хоть и не требует для установки первый пакет, но включает его в свои необязательные зависимости. В таких случаях необходимо просто переустановить второй пакет, чтобы он скомпилировался без связей с первым. Чтобы выявить все такие пакеты, вы можете использовать утилиту revdep-rebuild из пакета gentoolkit.</para></section><section><info><title>Логи Portage</title></info>
                                        <para>Все ваши действия с emerge отражаются в /var/log/emerge.log. К примеру, чтобы узнать, какой пакет сейчас компилируется, запустите tail /var/log/emerge.log. Преобразовать временные отметки в читаемый формат поможет простой <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://lxj.endofinternet.net/files/other/formatlog">python-скрипт</link> (с его использованием необходимо запустить tail /var/log/emerge.log | formatlog).</para>
                                        <para>Утилита genlop (emerge genlop) позволяет извлечь статистическую информацию из этого лог-файла. На пример, genlop -c скажет, какой пакет сейчас компилируется и как долго, и оценит количество оставшегося до конца установки времени.</para>
                                        <para>Дополнительно стоит также включить так называемые elog. При установке многих пакетов показываются важные уведомления, которые вы можете пропустить, если не следите за выполнением emerge. Добавьте в make.conf следующие строки:</para>
                                        <para># This sets what to log</para>
                                        <para>PORTAGE_ELOG_CLASSES="warn error log"</para>
                                        <para># And this is how to do it</para>
                                        <para>PORTAGE_ELOG_SYSTEM="save"</para>
                                        <para>и создайте каталог /var/log/portage/elog. Теперь уведомления для каждого пакета будут сохраняться в отдельном файле в созданном каталоге. Если вы хотите узнать больше о настройке elog, то изучите файл /etc/make.conf.example. Существуют также <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://sourceforge.net/projects/elogviewer/">графические утилиты</link> для просмотра этих логов.</para></section><section><info><title>Удаление временных файлов</title></info>
                                            <para>Если установка программы прервана ошибкой, в /var/tmp/portage остаётся временный каталог. Он будет автоматически удалён только после успешной установки этой программы, или же вы можете очистить этот каталог сами.</para>
                                            <para>Также через некоторое время довольно много файлов может оказаться в /usr/portage/distfiles. Используйте утилиту eclean из пакета gentoolkit, чтобы удалить дистрибутивы, которые вам больше не нужны. Эта утилита также удаляет старые бинарные пакеты, если вы их создавали (запускайте как eclean-dist и eclean-pkg соответственно). В странице руководства рассказывается о дополнительных параметрах.</para></section><section><info><title>Быстрый поиск пакетов</title></info>
                                                <para>Чтобы найти нужный пакет в локальном дереве Portage (и/или оверлеях), вы можете использовать emerge --search или emerge --searchdesc, но этот способ очень медленный. Поэтому лучше использовать <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://dev.croup.de/proj/eix">eix</link>. Eix индексирует список пакетов после каждой синхронизации (для этого необходимо набрать update-eix), а затем очень быстро выполняет поиск по пакетам (к примеру, eix moo выдаст список всех пакетов, которые содержат moo в названии). К тому же, вывод eix более информативен, чем вывод emerge.</para>
                                                <para>Eix позволяет искать по названию пакета, категории или описанию, использовать регулярные выражения, неточный поиск, ограничивать область поиска только установленными пакетами и многое другое. Как обычно, читайте man.</para></section><section><info><title>Уменьшение использования трафика</title></info>
                                                    <para>Обновление системы может быть связано с тратой большого количества сетевого трафика. Но есть способы уменьшить аппетиты Portage. Наиболее эффективно в этом преуспеет знаменитая утилита <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://deltup.sourceforge.net/">Deltup</link>, которая позволяет загружать не весь архив с исходными кодами, а только разность между новой и старой версией. Такой подход экономит до 90% размера загрузок. Установка Deltup <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://ru.gentoo-wiki.com/HOWTO_Экономия_трафика_с_помощью_deltup">описана</link> в Gentoo Wiki.</para>
                                                    <para>У Deltup, конечно, есть свои недостатки. Эта утилита не поддерживает докачку, а кроме того, вы зависите от загруженности сервера, генерирующего новые патчи (помнится, были плохие времена у deltup, когда дождаться очереди на генерацию было практически невозможно. Потом стало лучше, а после этого я уже давно deltup не пользуюсь — как там сейчас, не знаю). Также иногда Deltup «путается» в версиях некотрых пакетов, если у них запутанная система нумерации версий. Ну и конечно, пересоздание нового пакета требует процессорного времени. Однако же, никаких катастрофических последствий использование deltup иметь не может, так что если вы нуждаетесь в экономии трафика — обязательно её попробуйте.</para>
                                                    <para>Похожий подход, но для синхронизации дерева Portage использует утилита emerge-delta-webrsync: она загружает ежедневные патчи для обновления вашей локальной копии дерева, что гораздо экономнее, чем emerge --sync (особенно если у вас уже есть архив с копией дерева портежей — вроде того, который вы исполоьзовали при установке). Просто запустите emerge emerge-delta-webrsync, а затем emerge-delta-webrsync для синхронизации дерева портежей (мне всё ещё надо напоминать, что подробности — в man’е?).</para>
                                                    <para>На Gentoo wiki есть <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-wiki.com/TIP_Gentoo_for_dialup_users">специальный раздел</link> с советами для пользователей с плохим интернет-соединением.</para>
                                                    <para>Ещё одна возможность не уменьшит использование трафика, но позволит уменьшить время загрузки пакетов: добавьте parallel-fetch в переменную FEATURES в /etc/make.conf, чтобы emerge скачивал дистрибутив следующего пакета, устанавливая предыдущие в очереди. Это уменьшит время установки, если вы запускаете emerge для установки сразу нескольких пакетов.</para></section><section><info><title>Ускорение компиляции</title></info>
                                                        <para>Компиляция из исходных кодов — основной способ установки программ в Gentoo. Неудивительно, что появились средства, позволяющие ускорить этот процесс.</para>
                                                        <para>На пример, <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.gentoo.org/doc/en/distcc.xml">Distcc</link> позволяет распределить задачи по компиляции на несколько компьютеров в сети. Даже компьютеры с Windows <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-wiki.com/HOWTO_Distcc_server_on_Windows">сгодятся</link> для этого!</para>
                                                        <para>
                                                            <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-wiki.com/Ccache">Ccache</link> кэширует результаты компиляции, таким образом, ускоряя компиляцию одинаковых участков кода.</para>
                                                        <para>Упомянутые здесь утилиты можно использовать не только с emerge, но и вообще при любых компиляциях. Подробнее читайте в документации <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://distcc.samba.org/">Distcc</link> и <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://ccache.samba.org/">Ccache</link>.</para></section><section><info><title>Обновление конфигурационных файлов</title></info>
                                                            <para>После установки новых версий пакетов иногда необходимо обновить их конфигурационные файлы. В Handbook описана эта процедура с использованием утилиты etc-update, но существует более удобная и продвинутая утилита — <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo-wiki.com/Dispatch-conf">dispatch-conf</link>. Эта утилита имеет возможность автоматически обновлять конфигурационные файлы, в которых произошли простые изменения (на пример, изменились только комментарии), вы также можете указать ей автоматически обновлять конфигурационные файлы, в которые не вносились изменения пользователем. При этом конфигурационное файлы помещаются в контроль системой контроля версий, чтобы вы с лёгкостью могли откатить все изменения.</para>
                                                            <para>Ну и <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://bash.org/?464385">цитата</link> из bash.org’а напоследок:</para>
                                                            <para>&lt;@insomnia&gt; it only takes three commands to install Gentoo &lt;@insomnia&gt; cfdisk /dev/hda &amp;&amp; mkfs.xfs /dev/hda1 &amp;&amp; mount /dev/hda1 /mnt/gentoo/ &amp;&amp; chroot /mnt/gentoo/ &amp;&amp; env-update &amp;&amp; . /etc/profile &amp;&amp; emerge sync &amp;&amp; cd /usr/portage &amp;&amp; scripts/bootsrap.sh &amp;&amp; emerge system &amp;&amp; emerge vim &amp;&amp; vi /etc/fstab &amp;&amp; emerge gentoo-dev-sources &amp;&amp; cd /usr/src/linux &amp;&amp; make menuconfig &amp;&amp; make install modules_install &amp;&amp; emerge gnome mozilla-firefox openoffice &amp;&amp; emerge grub &amp;&amp; cp /boot/grub/grub.conf.sample /boot/grub/grub.conf &amp;&amp; vi /boot/grub/grub.conf &amp;&amp; grub &amp;&amp; init 6&lt;@insomnia&gt; that’s the first one</para>
                                                            <para>
                                                                <uri xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://gentoo.blog.ru/6345603.html">http://gentoo.blog.ru/6345603.html</uri>
                                                            </para></section></section>
</article>